{"ast":null,"code":"import _regeneratorRuntime from\"/Users/antonrybalkin/Projects/testtask/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/antonrybalkin/Projects/testtask/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/antonrybalkin/Projects/testtask/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState,useContext}from\"react\";import ComponentRadioGroup from\"./ComponentRadioGroup\";import ComponentInput from\"./ComponentInput\";import ComponentFileLoader from\"./ComponentFileLoader\";import Succes from\"../assets/success-image.svg\";import ComponentPhoneInput from\"./ComponentPhoneInput\";import{validateEmail,validateName,validationImg,validateForm}from\"./validate\";import{LocalContext}from\"./Context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Form=function Form(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),status=_useState4[0],setStatus=_useState4[1];var form=useRef();var _useContext=useContext(LocalContext),setRe_Render=_useContext.setRe_Render;useEffect(function(){fetch('https://frontend-test-assignment-api.abz.agency/api/v1/token').then(function(response){return response.json();}).then(function(data){setToken(data.token);});});function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var formData,status;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(e==undefined)){_context.next=3;break;}validateForm(null,{email:\"email\",name:\"name\",position_id:\"position_id\",phone:\"phone\",photo:\"photo\"});return _context.abrupt(\"return\");case 3:e.preventDefault();formData=new FormData(form.current);formData.set(\"phone\",\"+\"+document.querySelector(\"input[name='phone']\").value.replace(/[^\\d]/g,''));_context.next=8;return validateForm(formData,{email:\"email\",name:\"name\",position_id:\"position_id\",phone:\"phone\",photo:\"photo\"});case 8:status=_context.sent;if(status.succeed){fetch('https://frontend-test-assignment-api.abz.agency/api/v1/users',{method:'POST',body:formData,headers:{'Token':token}}).then(function(response){return response.json();}).then(function(data){if(data.success){setStatus(true);document.querySelector(\".registration_title\").style.display=\"none\";setRe_Render(true);}else{}});}case 10:case\"end\":return _context.stop();}}},_callee);}));return _handleSubmit.apply(this,arguments);}if(status==false){return/*#__PURE__*/_jsxs(\"form\",{className:\"registration_form\",ref:form,onSubmit:handleSubmit,noValidate:true,children:[/*#__PURE__*/_jsx(ComponentInput,{type:\"text\",name:\"name\",reqired:true,validator:validateName,placeholder:\"Your name\"},\"name\"),/*#__PURE__*/_jsx(ComponentInput,{type:\"email\",name:\"email\",reqired:true,validator:validateEmail,placeholder:\"Email\"},\"email\"),/*#__PURE__*/_jsx(ComponentPhoneInput,{name:\"phone\",reqired:true,placeholder:\"Phone\"},\"phone\"),/*#__PURE__*/_jsxs(\"label\",{className:\"registration_roleblock\",htmlFor:\"role\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"registration_roletitle\",children:\"Select your position\"}),/*#__PURE__*/_jsx(ComponentRadioGroup,{id:\"role\",name:\"position_id\",reqired:true})]}),/*#__PURE__*/_jsx(ComponentFileLoader,{validator:validationImg,name:\"photo\",reqired:true,placeholer:\"Upload your photo\"}),/*#__PURE__*/_jsx(\"input\",{type:\"submit\",className:\"registration_submit\",value:\"Sign up\"})]});}else{return/*#__PURE__*/_jsxs(\"div\",{className:\"registration_succes\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"registration_succestitle\",children:\"User successfully registered\"}),/*#__PURE__*/_jsx(\"img\",{src:Succes,className:\"registration_succesimg\",alt:\"succes\"})]});}};export default Form;","map":{"version":3,"names":["React","useEffect","useRef","useState","useContext","ComponentRadioGroup","ComponentInput","ComponentFileLoader","Succes","ComponentPhoneInput","validateEmail","validateName","validationImg","validateForm","LocalContext","Form","token","setToken","status","setStatus","form","setRe_Render","fetch","then","response","json","data","handleSubmit","e","undefined","email","name","position_id","phone","photo","preventDefault","formData","FormData","current","set","document","querySelector","value","replace","succeed","method","body","headers","success","style","display"],"sources":["/Users/antonrybalkin/Projects/testtask/src/components/ComponentForm.js"],"sourcesContent":["import React, {useEffect, useRef, useState, useContext} from \"react\";\nimport ComponentRadioGroup from \"./ComponentRadioGroup\";\nimport ComponentInput from \"./ComponentInput\"\nimport ComponentFileLoader from \"./ComponentFileLoader\";\nimport Succes from \"../assets/success-image.svg\";\nimport ComponentPhoneInput from \"./ComponentPhoneInput\";\nimport {validateEmail, validateName, validationImg, validateForm} from \"./validate\";\nimport {LocalContext} from \"./Context\";\n\nconst Form = () => {\n    const [token,\n        setToken] = useState(\"\");\n    const [status,\n        setStatus] = useState(false);\n    const form = useRef();\n    const {setRe_Render} = useContext(LocalContext);\n\n    useEffect(() => {\n        fetch('https://frontend-test-assignment-api.abz.agency/api/v1/token')\n            .then(function (response) {\n                return response.json();\n            })\n            .then(function (data) {\n                setToken(data.token)\n            })\n    })\n\n    async function handleSubmit(e) {\n        if (e == undefined) {\n            validateForm(null, {\n                email: \"email\",\n                name: \"name\",\n                position_id: \"position_id\",\n                phone: \"phone\",\n                photo: \"photo\"\n            })  \n            return;\n        }\n        e.preventDefault();\n\n        let formData = new FormData(form.current);\n        formData.set(\"phone\",\"+\"+document.querySelector(\"input[name='phone']\").value.replace(/[^\\d]/g, ''))\n        let status = await validateForm(formData, {\n            email: \"email\",\n            name: \"name\",\n            position_id: \"position_id\",\n            phone: \"phone\",\n            photo: \"photo\"\n        });\n         if (status.succeed) {\n\n            fetch('https://frontend-test-assignment-api.abz.agency/api/v1/users', {\n                    method: 'POST',\n                    body: formData,\n                    headers: {\n                        'Token': token\n                    }\n                })\n                .then(function (response) {\n                    return response.json();\n                })\n                .then(function (data) {\n                    if (data.success) {\n                        setStatus(true)\n                        document\n                            .querySelector(\".registration_title\")\n                            .style\n                            .display = \"none\";\n                        setRe_Render(true);\n                    } else {}\n                })\n         }\n    }\n\n    if (status == false) {\n        return (\n            <form\n                className={\"registration_form\"}\n                ref={form}\n                onSubmit={handleSubmit}\n                noValidate>\n                <ComponentInput\n                    key={\"name\"}\n                    type={\"text\"}\n                    name={\"name\"}\n                    reqired={true}\n                    validator={validateName}\n                    placeholder={\"Your name\"}></ComponentInput>\n                <ComponentInput\n                    key={\"email\"}\n                    type={\"email\"}\n                    name={\"email\"}\n                    reqired={true}\n                    validator={validateEmail}\n                    placeholder={\"Email\"}></ComponentInput>\n                <ComponentPhoneInput\n                    key={\"phone\"}\n                    name={\"phone\"}\n                    reqired={true}\n                    placeholder={\"Phone\"}></ComponentPhoneInput>\n                <label className={\"registration_roleblock\"} htmlFor={\"role\"}>\n                    <p className={\"registration_roletitle\"}>Select your position</p>\n                    <ComponentRadioGroup id={\"role\"} name={\"position_id\"} reqired={true}></ComponentRadioGroup>\n                </label>\n                <ComponentFileLoader\n                    validator={validationImg}\n                    name={\"photo\"}\n                    reqired={true}\n                    placeholer={\"Upload your photo\"}/>\n                <input type=\"submit\" className=\"registration_submit\" value=\"Sign up\"/>\n            </form>\n        )\n    } else {\n        return (\n            <div className={\"registration_succes\"}>\n                <h2 className={\"registration_succestitle\"}>User successfully registered</h2>\n                <img src={Succes} className={\"registration_succesimg\"} alt=\"succes\"></img>\n            </div>\n        )\n    }\n}\nexport default Form;"],"mappings":"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"},"metadata":{},"sourceType":"module"}